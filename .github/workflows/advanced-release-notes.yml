name: Advanced Auto Release Notes

on:
  push:
    tags:
      - 'v*' # vë¡œ ì‹œì‘í•˜ëŠ” íƒœê·¸ê°€ í‘¸ì‹œë  ë•Œ ì‹¤í–‰ë©ë‹ˆë‹¤

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write # GitHub ë¦´ë¦¬ìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ê¶Œí•œ
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # ì „ì²´ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤

      - name: Generate categorized release notes
        id: generate_release_notes
        run: |
          # ì´ì „ íƒœê·¸ ì°¾ê¸°
          PREVIOUS_TAG=$(git describe --tags --abbrev=0 HEAD^ 2>/dev/null || echo "")
          CURRENT_TAG=${GITHUB_REF#refs/tags/}
          
          # í—¤ë” ìƒì„±
          echo "# ë¦´ë¦¬ìŠ¤ ${CURRENT_TAG}" > release_notes.md
          echo "" >> release_notes.md
          
          if [ -z "$PREVIOUS_TAG" ]; then
            echo "## ì²« ë¦´ë¦¬ìŠ¤" >> release_notes.md
            RANGE="$(git rev-list --max-parents=0 HEAD)..HEAD"
          else
            echo "## ${PREVIOUS_TAG}ì—ì„œ ${CURRENT_TAG}ê¹Œì§€ì˜ ë³€ê²½ ì‚¬í•­" >> release_notes.md
            RANGE="${PREVIOUS_TAG}..HEAD"
          fi
          
          echo "" >> release_notes.md
          
          # ê¸°ëŠ¥ ì¶”ê°€ - feat: ë¡œ ì‹œì‘í•˜ëŠ” ì»¤ë°‹
          echo "### âœ¨ ìƒˆë¡œìš´ ê¸°ëŠ¥" >> release_notes.md
          git log --pretty=format:"* %s (%h)" ${RANGE} | grep -E "^* feat(\([^)]*\))?:" || echo "* ì´ë²ˆ ë¦´ë¦¬ìŠ¤ì— ì¶”ê°€ëœ ìƒˆ ê¸°ëŠ¥ì´ ì—†ìŠµë‹ˆë‹¤." >> release_notes.md
          echo "" >> release_notes.md
          
          # ë²„ê·¸ ìˆ˜ì • - fix: ë¡œ ì‹œì‘í•˜ëŠ” ì»¤ë°‹
          echo "### ğŸ› ë²„ê·¸ ìˆ˜ì •" >> release_notes.md
          git log --pretty=format:"* %s (%h)" ${RANGE} | grep -E "^* fix(\([^)]*\))?:" || echo "* ì´ë²ˆ ë¦´ë¦¬ìŠ¤ì— ìˆ˜ì •ëœ ë²„ê·¸ê°€ ì—†ìŠµë‹ˆë‹¤." >> release_notes.md
          echo "" >> release_notes.md
          
          # ë¬¸ì„œ - docs: ë¡œ ì‹œì‘í•˜ëŠ” ì»¤ë°‹
          echo "### ğŸ“ ë¬¸ì„œ" >> release_notes.md
          git log --pretty=format:"* %s (%h)" ${RANGE} | grep -E "^* docs(\([^)]*\))?:" || echo "* ì´ë²ˆ ë¦´ë¦¬ìŠ¤ì— ìˆ˜ì •ëœ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤." >> release_notes.md
          echo "" >> release_notes.md
          
          # ì„±ëŠ¥ ê°œì„  - perf: ë¡œ ì‹œì‘í•˜ëŠ” ì»¤ë°‹
          echo "### âš¡ ì„±ëŠ¥ ê°œì„ " >> release_notes.md
          git log --pretty=format:"* %s (%h)" ${RANGE} | grep -E "^* perf(\([^)]*\))?:" || echo "* ì´ë²ˆ ë¦´ë¦¬ìŠ¤ì— ê°œì„ ëœ ì„±ëŠ¥ì´ ì—†ìŠµë‹ˆë‹¤." >> release_notes.md
          echo "" >> release_notes.md
          
          # ë¦¬íŒ©í† ë§ - refactor: ë¡œ ì‹œì‘í•˜ëŠ” ì»¤ë°‹
          echo "### â™»ï¸ ì½”ë“œ ë¦¬íŒ©í† ë§" >> release_notes.md
          git log --pretty=format:"* %s (%h)" ${RANGE} | grep -E "^* refactor(\([^)]*\))?:" || echo "* ì´ë²ˆ ë¦´ë¦¬ìŠ¤ì— ë¦¬íŒ©í† ë§ëœ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤." >> release_notes.md
          echo "" >> release_notes.md
          
          # ìŠ¤íƒ€ì¼ - style: ë¡œ ì‹œì‘í•˜ëŠ” ì»¤ë°‹ 
          echo "### ğŸ’„ UI/ìŠ¤íƒ€ì¼ ë³€ê²½" >> release_notes.md
          git log --pretty=format:"* %s (%h)" ${RANGE} | grep -E "^* style(\([^)]*\))?:" || echo "* ì´ë²ˆ ë¦´ë¦¬ìŠ¤ì— ë³€ê²½ëœ ìŠ¤íƒ€ì¼ì´ ì—†ìŠµë‹ˆë‹¤." >> release_notes.md
          echo "" >> release_notes.md
          
          # ê¸°íƒ€ ë³€ê²½ - ìœ„ ì¹´í…Œê³ ë¦¬ì— í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ì»¤ë°‹
          echo "### ğŸ”§ ê¸°íƒ€ ë³€ê²½ì‚¬í•­" >> release_notes.md
          git log --pretty=format:"* %s (%h)" ${RANGE} | grep -v -E "^* (feat|fix|docs|perf|refactor|style)(\([^)]*\))?:" || echo "* ì´ë²ˆ ë¦´ë¦¬ìŠ¤ì— ê¸°íƒ€ ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤." >> release_notes.md
          
          # ë¦´ë¦¬ìŠ¤ ë…¸íŠ¸ í™•ì¸
          cat release_notes.md
          
          # í™˜ê²½ ë³€ìˆ˜ì— ë¦´ë¦¬ìŠ¤ ë…¸íŠ¸ ì €ì¥
          RELEASE_NOTES=$(cat release_notes.md)
          echo "RELEASE_NOTES<<EOF" >> $GITHUB_ENV
          echo "$RELEASE_NOTES" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          body: ${{ env.RELEASE_NOTES }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 